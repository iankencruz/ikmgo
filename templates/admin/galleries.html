{{ define "content" }}
<div class="flex flex-row justify-between">
  <h1 class="text-2xl font-bold">Galleries</h1>
  <a
    href="/admin/gallery/create"
    class="px-4 py-2 bg-blue-500 text-white rounded"
    >Create New Gallery</a
  >
</div>

<table class="w-full mt-4 border-collapse border border-gray-300">
  <thead>
    <tr class="bg-gray-200">
      <th class="border border-gray-300 px-4 py-2">ID</th>
      <th class="border border-gray-300 px-4 py-2">Cover Image</th>
      <!-- ✅ New column -->
      <th class="border border-gray-300 px-4 py-2">Title</th>
      <th class="border border-gray-300 px-4 py-2">Media Count</th>
      <!-- ✅ Separate column -->
      <th class="border border-gray-300 px-4 py-2">Actions</th>
    </tr>
  </thead>
  <tbody>
    {{ range .Galleries }}
    <tr>
      <td class="border border-gray-300 px-4 py-2">{{ .ID }}</td>

      <td class="border border-gray-300 px-4 py-2">
        <div class="flex items-center gap-2">
          <!-- ✅ Cover image container that HTMX will update -->
          <div id="cover-{{ .ID }}">
            {{ if .CoverImageURL }}
            <img
              src="{{ .CoverImageURL }}"
              class="w-16 h-16 object-cover rounded"
            />
            {{ else }}
            <div
              class="w-16 h-16 bg-gray-200 flex items-center justify-center rounded"
            >
              <span class="text-gray-500 text-xs">No Cover</span>
            </div>
            {{ end }}
          </div>

          <!-- ✅ Ensure HTMX triggers when selecting a new image -->
          <select
            class="block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
            hx-post="/admin/gallery/{{ .ID }}/cover"
            hx-trigger="change"
            hx-target="#cover-{{ .ID }}"
            hx-swap="outerHTML"
            name="media_id"
          >
            <option value="">Select Cover Image</option>
            {{ range index $.GalleryMedia .ID }}
            <option value="{{ .ID }}">{{ .FileName }}</option>
            {{ end }}
          </select>
        </div>
      </td>

      <td class="border border-gray-300 px-4 py-2">{{ .Title }}</td>
      <td class="border border-gray-300 px-4 py-2">{{ .MediaCount }} Images</td>
      <td class="border border-gray-300 px-4 py-2">
        <a href="/admin/gallery/edit/{{ .ID }}" class="text-blue-500">Edit</a> |
        <button
          hx-delete="/admin/gallery/{{ .ID }}"
          hx-confirm="Are you sure?"
          hx-target="#gallery-{{ .ID }}"
          hx-swap="outerHTML"
          class="text-red-500"
        >
          Delete
        </button>
      </td>
    </tr>
    {{ end }}
  </tbody>
</table>
{{ end }}
